<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <title>Change Password</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="styles.css">
</head>

<body class="home-page">
    <header>
        <nav>
            <div class="logo">Folio2Resume</div>
            <ul>
                <li><a href="home.html">Home</a></li>
                <li><a href="profile.html">Profile</a></li>
            </ul>
        </nav>
    </header>

    <div class="profile-container">

        <div class="profile-card">
            <h2>üîê Change Password</h2>

            <form id="changePasswordForm">

                <div class="input-group">
                    <label>Current Password</label>
                    <input type="password" id="oldPassword" required>
                </div>

                <div class="input-group">
                    <label>New Password</label>
                    <input type="password" id="newPassword" required>
                </div>

                <div class="input-group">
                    <label>Confirm New Password</label>
                    <input type="password" id="confirmPassword" required>
                </div>

                <button type="submit" class="edit-btn">Update Password</button>

                <!-- Professional message box -->
                <div id="passwordMsg" class="form-message"></div>
            </form>
        </div>

    </div>

    <script src="auth.js"></script>
    <script>
        /* LOGIN CHECK */
        const userId = Auth.getUserId();
        if (!userId) {
            window.location.href = "login.html";
        }

        /* CHANGE PASSWORD LOGIC */
        document.getElementById("changePasswordForm").addEventListener("submit", async function (e) {
            e.preventDefault();

            const oldPass = document.getElementById("oldPassword").value;
            const newPass = document.getElementById("newPassword").value;
            const confirmPass = document.getElementById("confirmPassword").value;

            if (newPass.length < 6) {
                showMsg("Password must be at least 6 characters", "error");
                return;
            }

            if (newPass !== confirmPass) {
                showMsg("Passwords do not match", "error");
                return;
            }

            try {
                const response = await fetch(`https://folio2resume-backend.onrender.com/api/auth/change-password/${userId}`, {
                    method: "POST",
                    headers: {
                        "Content-Type": "application/json"
                    },
                    body: JSON.stringify({
                        oldPassword: oldPass,
                        newPassword: newPass
                    })
                });

                const data = await response.text();

                if (response.ok) {
                    showMsg("Password updated successfully ‚úî", "success");
                    document.getElementById("changePasswordForm").reset();
                } else {
                    showMsg(data || "Error updating password", "error");
                }
            } catch (error) {
                showMsg("Network error. Please try again.", "error");
            }
        });

        function showMsg(text, type) {
            const msg = document.getElementById("passwordMsg");
            msg.innerText = text;
            msg.className = "form-message " + type;
            msg.style.display = "block";
        }
    </script>

</body>

</html>
